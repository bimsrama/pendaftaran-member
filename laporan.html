<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapor Kesehatan Final | My Gut Journey</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700;800&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #050505; color: #e5e5e5; }
        
        /* --- UTILITIES --- */
        .glass { 
            background: rgba(30, 30, 30, 0.4); 
            backdrop-filter: blur(16px); 
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .text-gold { 
            background: linear-gradient(135deg, #FDE68A 0%, #D97706 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scroller::-webkit-scrollbar { width: 3px; }
        .scroller::-webkit-scrollbar-track { background: #1a1a1a; }
        .scroller::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }

        /* --- ANIMATIONS --- */
        .fade-in-up { animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }

        /* Typing Cursor */
        .typing::after {
            content: '‚ñã';
            display: inline-block;
            margin-left: 2px;
            color: #fbbf24;
            animation: blink 1s step-start infinite;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* --- BADGES --- */
        .badge-locked { filter: grayscale(100%) opacity(0.3); transform: scale(0.9); transition: 0.3s; }
        .badge-unlocked { 
            filter: grayscale(0%) opacity(1); 
            transform: scale(1); 
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.15);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* --- CERTIFICATE --- */
        #cert-container { display: none; }
        .font-serif { font-family: 'Playfair Display', serif; }
    </style>
</head>
<body class="min-h-screen relative overflow-x-hidden pb-24">

    <div class="fixed inset-0 -z-10 pointer-events-none">
        <div class="absolute top-[-10%] right-[-20%] w-[500px] h-[500px] bg-amber-600/10 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-[-10%] left-[-20%] w-[400px] h-[400px] bg-emerald-600/10 rounded-full blur-[100px]"></div>
    </div>

    <div id="loading" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black transition-opacity duration-500">
        <div class="relative w-16 h-16">
            <div class="absolute inset-0 border-4 border-neutral-800 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-t-amber-500 rounded-full animate-spin"></div>
        </div>
        <p class="mt-4 text-[10px] text-neutral-500 tracking-[0.3em] animate-pulse">MEMUAT LAPORAN...</p>
    </div>

    <div id="main-content" class="max-w-md mx-auto px-5 pt-8 hidden">

        <div class="glass rounded-3xl p-6 mb-6 relative overflow-hidden fade-in-up" style="animation-delay: 0.1s;">
            <div class="flex items-center justify-between relative z-10">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 rounded-full p-[2px] bg-gradient-to-tr from-amber-400 to-transparent">
                        <img id="u-avatar" src="" class="w-full h-full rounded-full object-cover bg-neutral-900" alt="Avatar">
                    </div>
                    <div>
                        <p class="text-[10px] text-neutral-400 uppercase tracking-wider">Health Report</p>
                        <h1 id="u-name" class="text-lg font-bold text-white leading-tight">...</h1>
                        <span id="u-category" class="inline-block mt-1 text-[10px] px-2 py-0.5 bg-white/10 rounded text-amber-400 border border-white/5">...</span>
                    </div>
                </div>
                <button onclick="shareReferral()" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition border border-white/5 text-white">
                    <i class="fas fa-share-alt"></i>
                </button>
            </div>
        </div>

        <div class="glass rounded-3xl p-6 mb-6 border border-blue-500/10 relative overflow-hidden fade-in-up" style="animation-delay: 0.2s;">
            <div class="absolute -top-10 -right-10 w-32 h-32 bg-blue-500/10 rounded-full blur-[40px]"></div>
            
            <div class="flex justify-between items-center mb-3 relative z-10">
                <div class="flex items-center gap-2">
                    <div class="w-6 h-6 rounded bg-blue-500/20 flex items-center justify-center text-blue-400 text-xs">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3 class="text-sm font-bold text-blue-400">AI Highlight</h3>
                </div>
                <button onclick="refreshAI()" class="text-[10px] text-neutral-400 hover:text-white transition flex items-center gap-1 group">
                    <i id="refresh-icon" class="fas fa-sync-alt group-hover:rotate-180 transition duration-500"></i> Refresh
                </button>
            </div>

            <div class="min-h-[80px] relative z-10">
                <p id="ai-text" class="text-xs text-neutral-300 leading-relaxed italic">
                    </p>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mb-6 fade-in-up" style="animation-delay: 0.3s;">
            <div class="glass p-4 rounded-2xl text-center">
                <p class="text-[10px] text-neutral-500 uppercase">Total Hari</p>
                <p id="stat-day" class="text-3xl font-bold text-white my-1">0</p>
                <div class="w-full bg-neutral-800 h-1.5 rounded-full mt-2 overflow-hidden">
                    <div id="prog-bar" class="h-full bg-amber-500 w-0 transition-all duration-1000"></div>
                </div>
            </div>
            <div class="glass p-4 rounded-2xl text-center flex flex-col justify-center items-center">
                <div class="relative w-16 h-16">
                    <svg class="w-full h-full" viewBox="0 0 36 36">
                        <path class="text-neutral-800" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" />
                        <path id="circle-prog" class="text-green-500" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="currentColor" stroke-width="3" />
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center text-[10px] font-bold text-white" id="stat-percent">0%</div>
                </div>
                <p class="text-[10px] text-neutral-500 mt-2">Completion</p>
            </div>
        </div>

        <div class="mb-6 fade-in-up" style="animation-delay: 0.4s;">
            <div class="flex justify-between items-center mb-3 px-1">
                <h3 class="text-xs font-bold text-white uppercase tracking-widest">
                    <i class="fas fa-medal text-yellow-500 mr-1"></i> Achievements
                </h3>
            </div>
            <div class="flex gap-3 overflow-x-auto scrollbar-hide pb-2" id="badges-container">
                </div>
        </div>

        <div class="glass rounded-3xl p-5 mb-6 fade-in-up" style="animation-delay: 0.5s;">
            <h3 class="text-sm font-bold text-white mb-4 border-b border-white/5 pb-3 flex items-center gap-2">
                <i class="fas fa-map-signs text-amber-500"></i> Perjalanan Kesehatan
            </h3>
            
            <div class="space-y-4 max-h-80 overflow-y-auto scroller pr-2" id="journey-list">
                <div class="text-center py-10">
                    <i class="fas fa-circle-notch fa-spin text-neutral-600"></i>
                </div>
            </div>
            
            <a href="evaluasi.html" class="block mt-4 text-center text-xs text-amber-500 hover:text-amber-400 font-bold py-2 border border-amber-500/30 rounded-xl hover:bg-amber-500/10 transition">
                LIHAT SEMUA EVALUASI <i class="fas fa-arrow-right ml-1"></i>
            </a>
        </div>

        <div class="glass rounded-3xl p-5 mb-6 relative overflow-hidden border border-amber-500/20 fade-in-up" style="animation-delay: 0.6s;">
            <div class="absolute -left-10 top-0 w-40 h-40 bg-amber-500/10 rounded-full blur-[60px]"></div>
            
            <div class="relative z-10">
                <div class="flex items-start gap-3 mb-3">
                    <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center shrink-0">
                        <img src="https://down-id.img.susercontent.com/file/id-11134207-7r98o-lss74b0j165n03" class="w-10 h-10 object-contain">
                    </div>
                    <div>
                        <p class="text-[10px] text-amber-400 font-bold uppercase mb-0.5">Rekomendasi AI</p>
                        <h4 class="text-sm font-bold text-white">Jates9 Herbal Detox</h4>
                    </div>
                </div>
                
                <p id="product-reason" class="text-xs text-neutral-300 mb-4 leading-relaxed">
                    "Berdasarkan profil pencernaan Anda, Jates9 dapat membantu menyeimbangkan..."
                </p>

                <a href="https://shopee.co.id/jates9" target="_blank" class="block w-full bg-gradient-to-r from-amber-600 to-orange-600 text-white text-center text-xs font-bold py-3 rounded-xl shadow-lg shadow-orange-900/20 hover:scale-[1.02] transition-transform">
                    AMBIL PROMO SPESIAL <i class="fas fa-shopping-bag ml-1"></i>
                </a>
            </div>
        </div>

        <div id="cert-section" class="hidden mb-8 text-center fade-in-up">
            <div class="relative group cursor-pointer" onclick="downloadCert()">
                <div class="absolute -inset-1 bg-gradient-to-r from-amber-500 to-yellow-500 rounded-2xl blur opacity-30 group-hover:opacity-60 transition duration-500"></div>
                <button class="relative w-full bg-[#111] ring-1 ring-amber-500/50 text-white font-bold py-4 rounded-xl text-sm flex items-center justify-center gap-2">
                    <i class="fas fa-certificate text-amber-400"></i> DOWNLOAD SERTIFIKAT KELULUSAN
                </button>
            </div>
        </div>

        <div class="text-center pb-4">
            <p class="text-[10px] text-neutral-600">My Gut Journey Program &copy; 2024</p>
        </div>

    </div>

    <div id="cert-wrapper" class="fixed top-0 left-0 -z-50 opacity-0 pointer-events-none w-[800px]">
        <div id="certificate-box" class="p-16 text-center relative w-full aspect-[4/3] flex flex-col justify-center items-center bg-[#0a0a0a] border-8 border-double border-amber-600">
            <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#d97706 1px, transparent 1px); background-size: 20px 20px;"></div>
            <div class="absolute top-6 left-6 w-20 h-20 border-t-4 border-l-4 border-amber-500"></div>
            <div class="absolute top-6 right-6 w-20 h-20 border-t-4 border-r-4 border-amber-500"></div>
            <div class="absolute bottom-6 left-6 w-20 h-20 border-b-4 border-l-4 border-amber-500"></div>
            <div class="absolute bottom-6 right-6 w-20 h-20 border-b-4 border-r-4 border-amber-500"></div>

            <div class="relative z-10 w-full">
                <i class="fas fa-award text-6xl text-amber-500 mb-6 block"></i>
                <h1 class="text-6xl font-serif text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-orange-600 mb-2 font-bold tracking-wide">SERTIFIKAT KELULUSAN</h1>
                <p class="text-lg text-neutral-400 uppercase tracking-[0.4em] mb-10">PROGRAM USUS SEHAT 30 HARI</p>
                
                <p class="text-2xl text-neutral-300 italic font-serif">Diberikan kepada:</p>
                <h2 class="text-5xl font-bold text-white my-6 font-serif" id="cert-name">Nama Peserta</h2>
                
                <div class="w-1/2 mx-auto h-0.5 bg-gradient-to-r from-transparent via-amber-500 to-transparent my-8"></div>
                
                <p class="text-lg text-neutral-400 px-20 leading-relaxed font-serif">
                    Atas keberhasilan menyelesaikan tantangan kesehatan pencernaan selama 30 hari penuh dengan dedikasi yang luar biasa.
                </p>

                <div class="mt-12 flex justify-between items-end w-3/4 mx-auto">
                    <div class="text-center">
                        <div class="h-20 w-40 border-b border-neutral-600 mb-2 mx-auto"></div>
                        <p class="text-sm text-neutral-500 uppercase tracking-wider">Health Coach</p>
                    </div>
                    <div class="text-center">
                        <p class="text-amber-500 font-bold text-2xl mb-1">Jates9</p>
                        <p class="text-xs text-neutral-600">Official Program</p>
                    </div>
                    <div class="text-center">
                        <p class="text-white font-mono text-xl mb-2" id="cert-date">Date</p>
                        <div class="h-px w-40 bg-neutral-600 mb-2 mx-auto"></div>
                        <p class="text-sm text-neutral-500 uppercase tracking-wider">Tanggal Lulus</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‚ö†Ô∏è PASTE URL APP SCRIPT ANDA DISINI (Pastikan sudah Deploy New Version)
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx67JX5mM-n-W1h6ehURHgONXBPiyUvESRLMCveTV04wXighQQhLErXQwC07Yf5Zkkw/exec';
        
        // Link Pendaftaran untuk Referral
        const REG_LINK = "https://bimsrama.github.io/pendaftaran-member/index.html"; 

        const urlParams = new URLSearchParams(window.location.search);
        const waNumber = urlParams.get('wa');
        
        // State
        let typingTimeout = null;
        let currentCategory = 'Seimbang';
        let currentDay = 0;

        // --- DATABASE KONTEN AI ---
        const aiTipsDB = {
            'A': [ // Sembelit
                "üí° <strong>Tips Si Sembelit:</strong> Kurang serat? Coba makan pepaya atau naga pagi ini. Air hangat saat bangun tidur juga membantu peristaltik usus.",
                "üß† <strong>Fakta:</strong> Menahan BAB membuat feses mengeras. Jangan tunda jika sudah terasa!",
                "üßò <strong>Mindset:</strong> Stres bikin usus tegang. Lakukan nafas dalam 5 menit sekarang."
            ],
            'B': [ // Kembung
                "üí° <strong>Tips Si Kembung:</strong> Hindari minum pakai sedotan agar tidak menelan udara. Kunyah makanan sampai halus ya!",
                "üçµ <strong>Herbal:</strong> Jahe hangat sangat ampuh memecah gas di perut. Coba minum segelas.",
                "üö´ <strong>Pantangan:</strong> Kurangi kol, brokoli, dan soda hari ini jika perut terasa penuh."
            ],
            'C': [ // Sensitif
                "üí° <strong>Tips Si Sensitif:</strong> Ususmu butuh kelembutan. Makan makanan yang dimasak matang (bukan mentah/salad) hari ini.",
                "üß† <strong>Gut-Brain:</strong> Kecemasan memicu mules. Tenangkan pikiranmu, perutmu akan ikut tenang.",
                "üå∂Ô∏è <strong>Hindari:</strong> Pedas dan asam tinggi adalah musuhmu saat ini. Pilih yang netral seperti sup ayam."
            ],
            'Seimbang': [
                "üí° <strong>Tips Seimbang:</strong> Pertahankan! Usus sehat = Imunitas kuat. Jangan lupa hidrasi 2 liter hari ini.",
                "üåà <strong>Nutrisi:</strong> Coba makan sayur dengan 3 warna berbeda hari ini untuk mikrobioma beragam.",
                "üèÉ <strong>Aktif:</strong> Olahraga ringan 30 menit membantu metabolisme tetap lancar."
            ]
        };

        const promoDB = [
            "Jates9 mengandung herbal alami yang lembut, cocok untuk detoks harian tanpa melilit.",
            "Butuh booster serat? Jates9 diformulasikan khusus untuk melancarkan tanpa bikin ketergantungan.",
            "Promo Spesial Member: Dapatkan diskon bundle Jates9 khusus untuk kelulusan programmu nanti!",
            "Jaga hasil 30 hari ini dengan maintenance rutin pakai Jates9. Sehat itu investasi."
        ];

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            if(!waNumber) {
                Swal.fire({icon:'error', title:'Link Error', text:'Buka link ini dari pesan WhatsApp ya!', background:'#111', color:'#fff'});
                return;
            }
            fetchData();
        });

        // --- FETCH DATA ---
        function fetchData() {
            fetch(`${SCRIPT_URL}?action=getData&wa=${encodeURIComponent(waNumber)}`)
            .then(res => res.json())
            .then(data => {
                const loader = document.getElementById('loading');
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                    if(data.status === 'success') {
                        renderPage(data);
                    } else {
                        Swal.fire({icon:'error', title:'User Tidak Ditemukan', text:'Pastikan nomor WA sudah terdaftar.', background:'#111', color:'#fff'});
                    }
                }, 500);
            })
            .catch(err => {
                console.error(err);
                document.getElementById('loading').innerHTML = '<p class="text-red-500">Gagal Koneksi. Coba Refresh.</p>';
            });
        }

        // --- RENDER FUNCTIONS ---
        function renderPage(data) {
            document.getElementById('main-content').classList.remove('hidden');

            // 1. Profile
            document.getElementById('u-name').innerText = data.nama;
            document.getElementById('u-avatar').src = `https://api.dicebear.com/7.x/notionists/svg?seed=${data.nama}`;
            
            // Kategori Handling
            if(data.kategori.includes('Sembelit')) currentCategory = 'A';
            else if(data.kategori.includes('Kembung')) currentCategory = 'B';
            else if(data.kategori.includes('Sensitif')) currentCategory = 'C';
            
            document.getElementById('u-category').innerText = data.kategori.toUpperCase();
            
            // 2. Stats
            currentDay = parseInt(data.hari);
            document.getElementById('stat-day').innerText = currentDay;
            document.getElementById('stat-percent').innerText = data.progress + "%";
            
            // Animasi Bar & Circle
            setTimeout(() => {
                document.getElementById('prog-bar').style.width = data.progress + "%";
                const circle = document.getElementById('circle-prog');
                const circumference = 100; 
                const offset = circumference - (data.progress / 100 * circumference);
                circle.style.strokeDasharray = `${data.progress}, 100`;
            }, 500);

            // 3. AI Highlight
            refreshAI(true); // Initial Tip

            // 4. Badges (Kelipatan 5 Hari)
            renderBadges(currentDay);

            // 5. Journey List (Checkin + Evaluasi Gabung)
            renderJourney(data.checkin_log, data.history);

            // 6. Product Promo
            renderProductPromo();

            // 7. Sertifikat (Day 30 Check)
            if (currentDay >= 30) {
                document.getElementById('cert-section').classList.remove('hidden');
                document.getElementById('cert-name').innerText = data.nama;
                const today = new Date();
                const dateStr = today.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });
                document.getElementById('cert-date').innerText = dateStr;
            }
        }

        // --- LOGIC FUNCTIONS ---

        // AI Typing Effect
        function typeWriter(text, elementId, speed = 20) {
            const element = document.getElementById(elementId);
            element.innerHTML = "";
            element.classList.add('typing');
            
            if (typingTimeout) clearTimeout(typingTimeout);

            let i = 0;
            function type() {
                if (i < text.length) {
                    // Simple HTML tag skipper
                    if (text.charAt(i) === '<') {
                        let tag = '';
                        while (text.charAt(i) !== '>' && i < text.length) { tag += text.charAt(i); i++; }
                        tag += '>'; i++; element.innerHTML += tag;
                    } else {
                        element.innerHTML += text.charAt(i); i++;
                    }
                    typingTimeout = setTimeout(type, speed);
                } else {
                    element.classList.remove('typing');
                }
            }
            type();
        }

        function refreshAI(initial = false) {
            const icon = document.getElementById('refresh-icon');
            if(!initial) icon.classList.add('fa-spin');

            const textEl = document.getElementById('ai-text');
            if(!initial) textEl.style.opacity = '0';

            setTimeout(() => {
                if(!initial) icon.classList.remove('fa-spin');
                
                const tips = aiTipsDB[currentCategory] || aiTipsDB['Seimbang'];
                let newTip = tips[Math.floor(Math.random() * tips.length)];
                
                // Pastikan beda jika refresh
                if(!initial && textEl.innerHTML.includes(newTip) && tips.length > 1) {
                    newTip = tips[Math.floor(Math.random() * tips.length)];
                }

                textEl.style.opacity = '1';
                typeWriter(newTip, 'ai-text');
            }, initial ? 0 : 500);
        }

        // Badges Render
        function renderBadges(day) {
            const container = document.getElementById('badges-container');
            const milestones = [5, 10, 15, 20, 25, 30];
            const icons = ['üå±', 'üåø', 'üå≥', 'üçé', 'üí™', 'üèÜ'];
            
            let html = '';
            milestones.forEach((m, idx) => {
                const isUnlocked = day >= m;
                const cssClass = isUnlocked ? 'badge-unlocked bg-amber-900/20 text-white' : 'badge-locked bg-neutral-800 text-neutral-500';
                
                html += `
                    <div class="${cssClass} flex-shrink-0 w-16 h-20 rounded-xl flex flex-col items-center justify-center border border-white/5">
                        <div class="text-2xl mb-1">${icons[idx]}</div>
                        <p class="text-[9px] font-bold">Day ${m}</p>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Journey Render (Gabungan Checkin & Evaluasi)
        function renderJourney(checkins, evals) {
            const list = document.getElementById('journey-list');
            let content = '';

            // Gabung data & sort (Sederhana: Tampilkan Evaluasi di atas, lalu Checkin recent)
            // Note: Idealnya di sort by Date object, tapi format string dari GAS butuh parsing.
            // Kita tampilkan 5 checkin terakhir saja agar ringkas.
            
            if (!checkins || checkins.length === 0) {
                list.innerHTML = '<p class="text-center text-xs text-neutral-500 py-4">Belum ada aktivitas.</p>';
                return;
            }

            checkins.forEach((log) => {
                const isSpecial = log.detail && log.detail !== "Selesai";
                content += `
                    <div class="relative pl-6 border-l-2 border-neutral-800 pb-4 last:pb-0 group">
                        <div class="absolute -left-[5px] top-1 w-2.5 h-2.5 rounded-full bg-green-500 ring-4 ring-[#050505] group-hover:bg-green-400 transition"></div>
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="text-xs font-bold text-white">${log.ket}</p>
                                <p class="text-[10px] text-neutral-500">${log.tanggal}, ${log.jam}</p>
                            </div>
                            ${isSpecial ? '<i class="fas fa-comment-alt text-amber-500 text-xs"></i>' : '<i class="fas fa-check text-green-500/50 text-xs"></i>'}
                        </div>
                        ${isSpecial ? `<p class="mt-2 text-[10px] text-neutral-300 italic bg-white/5 p-2 rounded border-l-2 border-amber-500">"${log.detail}"</p>` : ''}
                    </div>
                `;
            });

            list.innerHTML = content;
        }

        // Product Ads
        function renderProductPromo() {
            const reasonEl = document.getElementById('product-reason');
            const randomReason = promoDB[Math.floor(Math.random() * promoDB.length)];
            reasonEl.innerText = `"${randomReason}"`;
        }

        // Referral Share
        function shareReferral() {
            const refLink = `${REG_LINK}?ref=${waNumber}`;
            const text = `Yuk ikutan program 30 Hari Usus Sehat bareng aku! Cek disini: ${refLink}`;
            
            if (navigator.share) {
                navigator.share({ title: 'My Gut Journey', text: text, url: refLink });
            } else {
                navigator.clipboard.writeText(text);
                Swal.fire({icon:'success', title:'Link Disalin!', text:'Bagikan ke temanmu sekarang.', background:'#111', color:'#fff', confirmButtonColor:'#d97706'});
            }
        }

        // Certificate Download
        function downloadCert() {
            const wrapper = document.getElementById('cert-wrapper');
            wrapper.style.opacity = '1'; wrapper.style.zIndex = '9999';
            
            html2canvas(document.querySelector("#certificate-box"), { scale: 2, useCORS: true, backgroundColor: "#000000" }).then(canvas => {
                wrapper.style.opacity = '0'; wrapper.style.zIndex = '-50';
                const link = document.createElement('a');
                link.download = 'Sertifikat-Usus-Sehat.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(err => {
                console.error(err);
                wrapper.style.opacity = '0';
                Swal.fire({icon:'error', title:'Gagal', text:'Coba screenshot manual ya.', background:'#111', color:'#fff'});
            });
        }

    </script>
</body>
</html>
